<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PN Digital Hub Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXX');
  </script>

  <style>
    body { background-color: #0f172a; color: #f1f5f9; font-family: 'Inter', sans-serif; }
    header { background: #1e293b; padding: 1rem; text-align: center; border-bottom: 2px solid #334155; }
    .card { background: #1e293b; border-radius: 1rem; padding: 1.5rem; margin: 1rem 0; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
    h1, h2 { font-weight: 600; }
    #map { height: 400px; border-radius: 1rem; }
    .alert { padding: 0.75rem; margin: 0.5rem 0; border-radius: 0.5rem; }
    .alert.positive { background: rgba(56, 189, 248, 0.2); border-left: 4px solid #38bdf8; }
    .alert.neutral { background: rgba(251, 191, 36, 0.2); border-left: 4px solid #fbbf24; }
    .alert.negative { background: rgba(239, 68, 68, 0.2); border-left: 4px solid #ef4444; }
    .alert.command { background: rgba(34, 197, 94, 0.2); border-left: 4px solid #22c55e; }
  </style>
</head>
<body>
  <header>
    <h1 class="text-2xl font-bold text-sky-400">PN Monitoring & Analytics Dashboard</h1>
    <p class="text-slate-400">ANCHOR Project ‚Äì Cognitive Warfare & Social Media Influence Tool</p>
  </header>

  <main class="p-4 grid md:grid-cols-2 gap-6">
    <!-- Section 1: Social Media Monitoring -->
    <section class="card">
      <h2 class="text-xl text-sky-300 mb-2">Social Media Monitoring Tool</h2>
      <ul class="list-disc list-inside text-slate-300 mb-4">
        <li>üî• "#WestPhilippineSea" spiking +45%</li>
        <li>‚öì "Philippine Navy rescue ops" trending in Palawan</li>
        <li>üö® Disinfo detected: "Fake ship sinking story"</li>
      </ul>
      <canvas id="sentimentChart"></canvas>
    </section>

    <!-- Section 2: Website Analytics -->
    <section class="card">
      <h2 class="text-xl text-sky-300 mb-2">Google Analytics ‚Äì Website Traffic</h2>
      <p class="text-slate-300">Real-time stats powered by Google Analytics:</p>
      <ul class="mt-3 space-y-1 text-slate-400">
        <li>üë• Real-Time Users: <strong>Auto from GA</strong></li>
        <li>üåç Top Locations: <strong>Auto from GA</strong></li>
        <li>üìÑ Popular Content: <strong>Articles, Infographics, Podcasts</strong></li>
      </ul>
    </section>

    <!-- Section 3: Sentiment Map -->
    <section class="card md:col-span-2">
      <h2 class="text-xl text-sky-300 mb-2">Philippines Sentiment & Engagement Map</h2>
      <div id="map"></div>
    </section>

    <!-- Section 4: Live Alerts Feed -->
    <section class="card md:col-span-1">
      <h2 class="text-xl text-sky-300 mb-2">Live Alerts Feed</h2>
      <div id="alertsFeed" class="space-y-2 text-sm"></div>
    </section>

    <!-- Section 5: Command Console -->
    <section class="card md:col-span-1">
      <h2 class="text-xl text-sky-300 mb-2">Command Console</h2>
      <form id="consoleForm" class="space-y-3">
        <input type="text" id="messageInput" placeholder="Enter counter-narrative message" class="w-full p-2 rounded bg-slate-700 text-slate-100">
        <select id="actionType" class="w-full p-2 rounded bg-slate-700 text-slate-100">
          <option value="post">üì¢ Schedule Post</option>
          <option value="boost">üöÄ Boost Content</option>
          <option value="alert">‚ö†Ô∏è Emergency Counter-Narrative</option>
        </select>
        <button type="submit" class="w-full py-2 bg-sky-600 rounded hover:bg-sky-700">Execute</button>
      </form>
      <div id="consoleLog" class="mt-3 space-y-2 text-sm text-slate-300"></div>
    </section>
  </main>

  <script>
    // --- Sentiment Data ---
    let sentimentData = { Positive: 55, Neutral: 25, Negative: 20 };

    // Chart setup
    const ctx = document.getElementById('sentimentChart');
    const sentimentChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(sentimentData),
        datasets: [{
          data: Object.values(sentimentData),
          backgroundColor: ['#38bdf8', '#fbbf24', '#ef4444'],
        }]
      },
      options: {
        plugins: { legend: { position: 'bottom', labels: { color: '#e2e8f0' } } }
      }
    });

    // Map setup
    var map = L.map('map').setView([12.8797, 121.7740], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    var regions = [
      { name: "Metro Manila", coords: [14.5995, 120.9842], sentiment: "Positive" },
      { name: "Palawan", coords: [9.8349, 118.7384], sentiment: "Neutral" },
      { name: "Zambales", coords: [15.363, 119.9509], sentiment: "Negative" }
    ];

    function updateMap() {
      regions.forEach(region => {
        var color = region.sentiment === "Positive" ? "blue" :
                    region.sentiment === "Neutral" ? "orange" : "red";
        L.circleMarker(region.coords, {
          radius: 10,
          color: color,
          fillOpacity: 0.7
        }).addTo(map).bindPopup(`<b>${region.name}</b><br>Sentiment: ${region.sentiment}`);
      });
    }
    updateMap();

    // --- Live Alerts Feed ---
    const alerts = [
      { type: "positive", text: "‚úÖ Public support rising in Metro Manila after Navy relief ops." },
      { type: "negative", text: "üö® Disinfo narrative detected in Zambales: 'Navy abandoned fishermen'." },
      { type: "neutral", text: "‚ÑπÔ∏è Neutral chatter in Palawan about joint patrols." },
      { type: "positive", text: "‚öì Influencer collaboration boosted PN awareness campaign." }
    ];
    let alertIndex = 0;

    function pushAlert(alertObj) {
      const feed = document.getElementById("alertsFeed");
      const div = document.createElement("div");
      div.className = `alert ${alertObj.type}`;
      div.textContent = alertObj.text;
      feed.prepend(div);
    }

    // Simulate automated alerts every 4s
    setInterval(() => {
      if (alertIndex < alerts.length) {
        pushAlert(alerts[alertIndex]);
        alertIndex++;
      }
    }, 4000);

    // --- Command Console ---
    document.getElementById("consoleForm").addEventListener("submit", function(e){
      e.preventDefault();
      const msg = document.getElementById("messageInput").value;
      const action = document.getElementById("actionType").value;
      if(!msg) return;

      // Log operator action
      const log = document.getElementById("consoleLog");
      const entry = document.createElement("div");
      entry.className = "p-2 bg-slate-800 rounded";
      entry.textContent = `Executed: ${action.toUpperCase()} ‚Üí "${msg}"`;
      log.prepend(entry);

      // Push operator action to alerts feed
      pushAlert({ type: "command", text: `üëÆ PN Operator Action: ${msg}` });

      // Sentiment impact simulation if emergency
      if(action === "alert"){
        sentimentData.Positive += 5;
        sentimentData.Negative -= 5;
        sentimentChart.data.datasets[0].data = Object.values(sentimentData);
        sentimentChart.update();
      }

      document.getElementById("consoleForm").reset();
    });
  </script>
</body>
</html>
